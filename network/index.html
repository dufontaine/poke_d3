<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>poke_d32</title>
  <link rel="stylesheet" href="stylenetwork.css">
  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<!--  <script src='js/Radar.js'></script>-->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<!--  <script src="js/index.js"></script>-->
</head>

<!--<meta charset="utf-8">-->
<style>
    
path.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}

.link {
  stroke: #ccc;
}

.node text {
  pointer-events: none;
  font: 10px sans-serif;
}

</style>

<body>

<!--// top border-->
   <table style='border-collapse: collapse;' width=1335px> 
        <tr>
            <td colspan=15 id='TITLE'>POKE-VIZ:  NETWORK ANALYZER </td>
        </tr>
    
            <tr>
            <td  class="Normal Rainbow"></td>
            <td  class="Fire Rainbow"></td>
            <td  class="Water Rainbow"></td>
            <td  class="Electric Rainbow"></td>
            <td  class="Grass Rainbow"></td>
            <td  class="Ice Rainbow"></td>
            <td  class="Fighting Rainbow"></td>
            <td  class="Poison Rainbow"></td>
            <td  class="Ground Rainbow"></td>
            <td  class="Flying Rainbow"></td>
            <td  class="Psychic Rainbow"></td>
            <td  class="Bug Rainbow"></td>
            <td  class="Rock Rainbow"></td>
            <td  class="Ghost Rainbow"></td>
            <td  class="Dragon Rainbow"></td>
        </tr>
    </table>
    <div height='6px;' style='font-size:6px;'>&nbsp;</div>
    
<!--    //dialog box-->
        <tr>
            <td rowspan="3" style="vertical-align:text-bottom">
                <div id="page_Description">
                    My my, You have so many Pokemon to choose from! <br><br>
                    From the right you can select individual Pokemon to read
                    their name, type, and network measure. <br><br>
                    You can also choose to select type of Pokemon and Pokemons
                    with more than one type to help build your team. <br><br>
                    -Professor Oak
                </div>
            </td>
        </tr>
    
<!--//selection box-->
    
     <table>
        <tr height=50px>
                <div id="one_Poke">
                    <span id="selText">Select Pokemon:  </span>
                    <select id="myDD">test</select>
                    <div class="chart-wrap">
                        <table style="width:225px; text-align: right">
    </table>
                        
         <table>
        <tr height=50px>
                <div id="one_Poke">
                    <span id="selText">Select Type:  </span>
                    <select id="myDD2">test</select>
                    <div class="chart-wrap">
                        <table style="width:225px; text-align: right">
    </table>
                        

<!--
         <table>
        <tr height=100px>
                <div id="one_Poke">
                    <span id="selText">Select Pokemon with more than 1 type:  </span>
                    <select id="myDD3">test</select>
                    <div class="chart-wrap">
                        <table style="width:225px; text-align: right">
    </table>
-->
    
    <td>

        <div id="2types" class='twotypes'>Two types</div>
        <div class="chart-wrap">
    </td>    
    
<!--<script src="https://d3js.org/d3.v3.min.js"></script>-->
<script>

var tcBlack = "#130C0E";
var x_browser = 20,
    y_browser = 25;
    
var width = 1200,
    height = 1200,
    radius = 6;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var force = d3.layout.force()
    .gravity(0.05)
    .distance(100)
    .charge(-100)
    .size([width, height]);
    
svg.append("defs").selectAll("marker")
    .data(["end"])
  .enter().append("marker")
    .attr("id", function(d) { return d; })
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 25)
    .attr("refY", 0)
    .attr("markerWidth", 15)
    .attr("markerHeight", 15)
    .attr("orient", "auto")
  .append("path")
    .attr("d", "M0,-5L10,0L0,5 L10,0 L0, -5")
    .style("stroke", "#4679BD")
    .style("opacity", "0.6");
    

//creates drop-down list to pick pokemon
function createDD(dat){
    d3.select("#myDD")
    .selectAll("option")
    .data(dat.sort(function(a,b) {return (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0);} ))
    .enter()
    .append("option")
    .attr("value", function(d) {return d.id;})
    .text(function(d) {
        return d.id; 
    });
    return 0;
}
    
//create drop-down list to pick type of pokemon    
    
function createDD2(dat){ 
    
  var nest = d3.nest()
  .key(function(d) { return d.type1;})
  .entries(dat);
    
    d3.select("#myDD2")
    .selectAll("option")
    .data(nest.sort(function(a,b) {return (a.type1 > b.type1) ? 1 : ((b.type1 > a.type1) ? -1 : 0);} ))
    .enter()
    .append("option")
    .attr("value", function(d) {return d.key;})
    .text(function(d) {
        return d.key; 
    });
    return 0;
}
    
//create drop-down list to pick pokemon with more than 1 type 
    
function createDD3(dat){
    
  var nest = d3.nest()
  .key(function(d) { return d.morethan1type;})
  .entries(dat);

    
    d3.select("#myDD3")
    .selectAll("option")
    .data(nest.sort(function(a,b) {return (a.morethan1type > b.morethan1type) ? 1 : ((b.morethan1type > a.morethan1type) ? -1 : 0);} ))
    .enter()
    .append("option")
    .attr("value", function(d) {return d.key;})
    .text(function(d) {
        return d.key; 
    });
    return 0;
}
     
    
//    d3.selection.prototype.moveToFront = function() {  
//      return this.each(function(){
//        this.parentNode.appendChild(this);
//      });
//    };
//    d3.selection.prototype.moveToBack = function() {  
//        return this.each(function() { 
//            var firstChild = this.parentNode.firstChild; 
//            if (firstChild) { 
//                this.parentNode.insertBefore(this, firstChild); 
//            } 
//        });
//    };

d3.json("https://gist.githubusercontent.com/chosun41/a6b49548df20b6d25f94152bf4b9eda3/raw/8c9a373de0430e3e37e1257cd7b3722f914d00cc/pokemon.json", function(error, json) {
  if (error) throw error;
    
//fill selection box
    createDD(json.nodes)
    createDD2(json.nodes)
    createDD3(json.nodes)

  var edges = [];
    json.links.forEach(function(e) {
    var sourceNode = json.nodes.filter(function(n) {
        return n.id === e.source;
    })[0],
        targetNode = json.nodes.filter(function(n) {
            return n.id === e.target;
        })[0];

    edges.push({
        source: sourceNode,
        target: targetNode,
        value: e.Value
    });
})
  
  force
      .nodes(json.nodes)
      .links(edges)
      .start();

  var link = svg.selectAll(".link")
      .data(edges)
      .enter().append("line")
      .attr("class", "link")
      .style("marker-end",  "url(#end)");

  var node = svg.selectAll(".node")
      .data(json.nodes)

    // Enter any new nodes.
  var nodeEnter = node.enter().append("svg:g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
      .call(force.drag);
 
  // Append a circle
  nodeEnter.append("svg:circle")
      .attr("r", function(d) { return 20; })
 
  // Append images
  var images = nodeEnter.append("svg:image")
        .attr("xlink:href",  function(d) { return d.img;})
        .attr("x", function(d) { return -25;})
        .attr("y", function(d) { return -25;})
        .attr("height", 50)
        .attr("width", 50);
  
    // make the image grow a little on mouse over and add the text details on click
  var setEvents = images
          // Append hero text
          .on( 'mouseenter', function() {
            // select element in current context
            d3.select( this )
              .transition()
              .attr("x", function(d) { return -100;})
              .attr("y", function(d) { return -100;})
              .attr("height", 200)
              .attr("width", 200)
          })
          // set back
          .on( 'mouseleave', function() {
            d3.select( this )
              .transition()
              .attr("x", function(d) { return -25;})
              .attr("y", function(d) { return -25;})
              .attr("height", 50)
              .attr("width", 50);
          });


 /*nodeEnter.append("text")
      .attr("class", "nodetext")
      .attr("x", x_browser)
      .attr("y", y_browser +15)
      .attr("fill", tcBlack)
      .text(function(d) { return d.id; });

node.exit().remove();*/

  force.on("tick", function() {
    node.attr("cx", function(d) { return d.x = Math.max(radius, Math.min(width - radius, d.x)); })
        .attr("cy", function(d) { return d.y = Math.max(radius, Math.min(height - radius, d.y)); });    
      
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
  });
});

</script>