<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>poke_d32</title>
  <link rel="stylesheet" href="stylenetwork.css">
  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<!--  <script src='js/Radar.js'></script>-->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<!--  <script src="js/index.js"></script>-->
</head>

<!--<meta charset="utf-8">-->
<style>
    
path.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}

.link {
  stroke: #ccc;
}

.node text {
  pointer-events: none;
  font: 10px sans-serif;
}

</style>

<body>

<!--// top border-->
   <table style='border-collapse: collapse;' width=1500px> 
        <tr>
            <td colspan=15 id='TITLE'>POKE-VIZ:  NETWORK ANALYZER </td>
        </tr>
    
            <tr>
            <td  class="Normal Rainbow"></td>
            <td  class="Fire Rainbow"></td>
            <td  class="Water Rainbow"></td>
            <td  class="Electric Rainbow"></td>
            <td  class="Grass Rainbow"></td>
            <td  class="Ice Rainbow"></td>
            <td  class="Fighting Rainbow"></td>
            <td  class="Poison Rainbow"></td>
            <td  class="Ground Rainbow"></td>
            <td  class="Flying Rainbow"></td>
            <td  class="Psychic Rainbow"></td>
            <td  class="Bug Rainbow"></td>
            <td  class="Rock Rainbow"></td>
            <td  class="Ghost Rainbow"></td>
            <td  class="Dragon Rainbow"></td>
        </tr>
    </table>
    
    <div height='6px;' style='font-size:6px;'>&nbsp;</div>

<!--dialog box-->
   <table style="float: left;">
            <td id="dialog_box" rowspan="2"> 
                <div id="page_Description">
                    My my, You have so many Pokemon to choose from! <br><br>
                    From the right, you have a number of tools to analyze the Pokemon network. <br><br>
                    You can filter by Pokemon, types, and size by network attributes. <br><br>
                    Good luck on building your team of Pokemon! <br><br>
                    -Professor Oak
                </div>
            </td>  
    </table>
    
<!-- pr oak-->
    <table style="float: left;">
            <td id="proak" rowspan="2"> 
                    <img src="proak.png" style="width:160px;height:250px;margin:15px 20px 0px 10px">
            </td>  
    </table>
    
<!-- buttons and filters-->

    
<!--text of pokemon and type stats-->
    
<!--individual pokemon stats-->   
<table style="float: left;margin-right:20px", cellpadding="22">
            <td> 
                    <div id="sel_poke">Select Pokemon:
                        <select id="myDD">test</select>
                    </div>
                    <div id="poketype1">Type 1: </div>
                    <div id="poketype2">Type 2: </div>
                    <div id="usage"> Usage: </div>
                    <div id="pokedgr"> In Degree: </div>
                    <div id="pokebt">Between Centrality: </div>
                    <div id="pokepgr">Page Rank Prob.: </div>
                    <div id="vblty"> Viability: </div>
            </td>
</table>

<!--type pokemon stats-->   
<table style="float: left;margin-right:20px", cellpadding="17">
            <td> 
                    <div id="sel_type">Select Type:    
                        <select id="myDD2">test</select>
                    </div>
                    <div id="type">Type: </div>
                    <div id="count">Count: </div>
            </td>
</table>
    
<table style="float: left;margin-right:20px", cellpadding="17">
            <td> 
                    <div id="sel_cent">Size By:    
                        <select id="myDD3">test</select>
                    </div>
                    <div id="maxcent">Max: </div>
                    <div id="mincent">Min: </div>
                    <div id="top1">Rank 1: </div>
                    <div id="top2">Rank 2: </div>
                    <div id="top3">Rank 3: </div>
                    <div id="top4">Rank 4: </div>
                    <div id="top5">Rank 5: </div>
                    <div id="top6">Rank 6: </div>
            </td>
</table>
    
<table style="float: left;margin-right:20px", cellpadding="17">
            <td> 
                <div id="Reset", class='Reset'>Reset</div>
            </td>
</table>
    
    
<!--script-->
<script>

var tcBlack = "#130C0E";
var x_browser = 20,
    y_browser = 25;
    
var width = 1400,
    height = 1050,
    radius = 60;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
 
//arrows    
svg.append("defs").selectAll("marker")
    .data(["end"])
  .enter().append("marker")
    .attr("id", function(d) { return d; })
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 25)
    .attr("refY", 0)
    .attr("markerWidth", 15)
    .attr("markerHeight", 15)
    .attr("orient", "auto")
  .append("path")
    .attr("d", "M0,-5L10,0L0,5 L10,0 L0, -5")
    .style("stroke", "#4679BD")
    .style("opacity", "0.6");

//force layout
var force = d3.layout.force()
    .gravity(0.05)
    .distance(100)
    .charge(-100)
    .size([width, height]);
    

//creates drop-down list to pick pokemon
function createDD(dat){
    d3.select("#myDD")
    .selectAll("option")
    .data(dat.sort(function(a,b) {return (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0);} ))
    .enter()
    .append("option")
    .attr("value", function(d) {return d.id;})
    .text(function(d) {
        return d.id; 
    });
    return 0;
}
    
//create drop-down list to pick type of pokemon    
    
function createDD2(dat){ 
    
    var alltypes=[]
    
    //make list of all unique type 1 and type 2
    dat.forEach(function(d){
       alltypes.push(d.type1); 
       alltypes.push(d.type2);
    });
    alltypes=Array.from(new Set(alltypes));
    alltypes.push("Two Types");
    
    //replace None with One Type
    var index = alltypes.indexOf("None");

    alltypes[index] = "One Type";
    
  var nest = d3.nest()
  .key(function(d) { return d;}).sortKeys(d3.ascending)
  .entries(alltypes);
    
    d3.select("#myDD2")
    .selectAll("option")
    .data(nest)
    .enter()
    .append("option")
    .attr("value", function(d) {return d.key;})
    .text(function(d) {
        return d.key; 
    });
    return 0;
}
    
//create drop-down list to size nodes by centrality measure
    
function createDD3(){
    
  var sizeby=['Usage','In Degree','Between Centrality','Page Rank Prob.','Viability']
    
  var nest = d3.nest()
  .key(function(d) { return d;}).sortKeys(d3.ascending)
  .entries(sizeby);
    
    d3.select("#myDD3")
    .selectAll("option")
    .data(nest)
    .enter()
    .append("option")
    .attr("value", function(d) {return d.key;})
    .text(function(d) {
        return d.key; 
    });
    return 0;
}
     
    
/*    d3.selection.prototype.moveToFront = function() {  
      return this.each(function(){
        this.parentNode.appendChild(this);
      });
    };
    d3.selection.prototype.moveToBack = function() {  
        return this.each(function() { 
            var firstChild = this.parentNode.firstChild; 
            if (firstChild) { 
                this.parentNode.insertBefore(this, firstChild); 
            } 
        });
    };*/

d3.json("https://gist.githubusercontent.com/chosun41/8fb833faa458375657fa110126be2527/raw/162eabacb80394e699ee9d451334845bdbc1ed84/pokemon2.json", function(error, json) {
  if (error) throw error;
    
//fill selection box
    createDD(json.nodes)
    createDD2(json.nodes)
    createDD3()

  var edges = [];
    json.links.forEach(function(e) {
    var sourceNode = json.nodes.filter(function(n) {
        return n.id === e.source;
    })[0],
        targetNode = json.nodes.filter(function(n) {
            return n.id === e.target;
        })[0];

    edges.push({
        source: sourceNode,
        target: targetNode,
        value: e.Value
    });
})
  
  force
      .nodes(json.nodes)
      .links(edges)
      .start();

  var link = svg.selectAll(".link")
      .data(edges)
      .enter().append("line")
      .attr("class", "link")
      .style("marker-end",  "url(#end)");

  var node = svg.selectAll(".node")
      .data(json.nodes)

    // Enter any new nodes.
  var nodeEnter = node.enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
      .call(force.drag);

  // Append a circle
  var circles= nodeEnter.append("circle")
      .attr("id", "circles")
      .attr("r", function(d) { return 20; })
/*    .attr('class', 'click-capture')
      .style('visibility', 'hidden')*/
      .text(function(d) {return d.type1 + ' ' + d.type2;});
    
  //tooltip for ids
  var title=  nodeEnter.append("title")
    .attr("id", "title")
    .text(function(d) {return ' ' + d.id;});
    
  // Append images
  var images = nodeEnter.append("image")
        .attr("id", "images")
        .attr("xlink:href",  function(d) { return d.img;})
        .attr("x", function(d) { return -25;})
        .attr("y", function(d) { return -25;})
        .attr("height", 50)
        .attr("width", 50);
    
  
  // make the image grow a little on mouse over and add the text details on click
  var setEvents = images
          // on mouse enter grow
          .on( 'mouseenter', function() {
            // select element in current context
            d3.select( this )
              .transition()
              .attr("x", function(d) { return -100;})
              .attr("y", function(d) { return -100;})
              .attr("height", 200)
              .attr("width", 200)
          })
          // set back
          .on( 'mouseleave', function() {
            d3.select( this )
              .transition()
              .attr("x", function(d) { return -25;})
              .attr("y", function(d) { return -25;})
              .attr("height", 50)
              .attr("width", 50)
          });

//function to select type of pokemon and color change
 d3.select('#myDD2').on('change', function(){
        //get type selected
        var seltype = d3.select("#myDD2").node().value
        
       //reset all circle colors to black and full opacity
        nodeEnter.each(function(d, i){
                var thisnode2=d3.select(this);
                thisnode2.attr("class","Black");
                thisnode2.transition().style("opacity", 1);
                thisnode2.select('image')
                .transition()
                .attr("x", function(d) { return -25;})
                .attr("y", function(d) { return -25;})
                .attr("height", 50)
                .attr("width", 50)
        })
     
        //generate text
        document.getElementById("type").innerHTML = 'Type: ' + seltype;
        var count=0;

        // if the node type matches switch color else turn grey, special cases for one type and two type
        nodeEnter.each(function(d, i){
            var thisnode=d3.select(this);
            var nodetype = thisnode.text();
            var tokens =nodetype.split(" ");
            if(tokens[0]==seltype || tokens[1]==seltype){
                thisnode.attr("class", seltype);
                count++;
            }
            else if(seltype=="One Type" && tokens[1]=="None"){
                thisnode.attr("class", "Black");
                count++;
            }
            else if(seltype=="Two Types" && tokens[1]!="None"){
                thisnode.attr("class", "Black");
                count++;
            }
            else{
                thisnode.transition().style("opacity", 0.05);
            }
        })
     
        var prcnt = (count/146*100).toFixed(2);
     
        document.getElementById("count").innerHTML = 'Count: ' + count + ' (' + prcnt + '%)';
 });
    
//function to select individual pokemon and color change    
 d3.select('#myDD').on('change', function(){
        //get type selected
        var selpoke = d3.select("#myDD").node().value
     
        //get the array of the node matching the pokemon
        var varname=json.nodes.filter(function (a) {
            return (a.id == selpoke);
            })[0];
        document.getElementById("poketype1").innerHTML = 'Type 1: ' + varname.type1;
        document.getElementById("poketype2").innerHTML = 'Type 2: ' + varname.type2;
        document.getElementById("usage").innerHTML = 'Usage: ' + (varname.usage*100).toFixed(2) + "%";
        document.getElementById("pokedgr").innerHTML = 'In Degree: ' + varname.din;
        document.getElementById("pokebt").innerHTML = 'Between Centrality: ' + varname.bt;
        document.getElementById("pokepgr").innerHTML = 'Page Rank Prob.: ' + (varname.pgr*100).toFixed(2) + "%";
        document.getElementById("vblty").innerHTML = 'Viability: ' + varname.gxe95;
        
        //reset all circle colors to black and full opacity and reverse enlargements
        nodeEnter.each(function(d, i){
                var thisnode2=d3.select(this);
                thisnode2.attr("class","Black");
                thisnode2.transition().style("opacity", 1);
                thisnode2.select('image')
                .transition()
                .attr("x", function(d) { return -25;})
                .attr("y", function(d) { return -25;})
                .attr("height", 50)
                .attr("width", 50)
        })

        // if the node type matches switch color to type 1
        nodeEnter.each(function(d, i){
            var thisnode=d3.select(this);
            var nodetype = thisnode.text();
            var tokens =nodetype.split(" ");
            if(tokens[2]==selpoke){
                thisnode.attr("class", "Black");
                thisnode.select('image')
                .transition()
                .attr("x", function(d) { return -100;})
                .attr("y", function(d) { return -100;})
                .attr("height", 200)
                .attr("width", 200)
            }
            else{
                thisnode.transition().style("opacity", 0.05);
            }
        })
 });
    
//size by centrality measure   
 d3.select('#myDD3').on('change', function(){
        //get type selected
        var selcent = d3.select("#myDD3").node().value
        
/*      //reset all circle colors to black and full opacity and reverse enlargements
        nodeEnter.each(function(d, i){
                var thisnode2=d3.select(this);
                thisnode2.attr("class","Black");
                thisnode2.transition().style("opacity", 1);
                thisnode2.select('image')
                .transition()
                .attr("x", function(d) { return -25;})
                .attr("y", function(d) { return -25;})
                .attr("height", 50)
                .attr("width", 50)
        })*/

        // sorted nodes by centrality measure
        var descusage=json.nodes.sort(function(a,b) {return (a.usage < b.usage) ? 1 : ((b.usage < a.usage) ? -1 : 0);})
/*        var ascusage=json.nodes.sort(function(a,b) {return (a.usage > b.usage) ? 1 : ((b.usage > a.usage) ? -1 : 0);})
        var desind=json.nodes.sort(function(a,b) {return (a.ind < b.ind) ? 1 : ((b.ind < a.ind) ? -1 : 0);})
        var ascind=json.nodes.sort(function(a,b) {return (a.ind > b.ind) ? 1 : ((b.ind > a.ind) ? -1 : 0);})
        var descbt=json.nodes.sort(function(a,b) {return (a.bt < b.bt) ? 1 : ((b.bt < a.bt) ? -1 : 0);})
        var ascbt=json.nodes.sort(function(a,b) {return (a.bt > b.bt) ? 1 : ((b.bt > a.bt) ? -1 : 0);})
        var descpgr=json.nodes.sort(function(a,b) {return (a.pgr < b.pgr) ? 1 : ((b.pgr < a.pgr) ? -1 : 0);})
        var ascpgr=json.nodes.sort(function(a,b) {return (a.pgr > b.pgr) ? 1 : ((b.pgr > a.pgr) ? -1 : 0);})
        var descvblty=json.nodes.sort(function(a,b) {return (a.gxe95 < b.gxe95) ? 1 : ((b.gxe95 < a.gxe95) ? -1 : 0);})
        var ascvblty=json.nodes.sort(function(a,b) {return (a.gxe95 > b.gxe95) ? 1 : ((b.gxe95 > a.gxe95) ? -1 : 0);})*/
     
        // for each node change the size first identifying pokemon from the node text and then conditional for each
        //centrality measure
        nodeEnter.each(function(d, i){
            var thisnode=d3.select(this);
            var nodetxt = thisnode.text();
            var tokens =nodetxt.split(" ");
            // return node matching the id from tokens[2]
            var varname=json.nodes.filter(function (a) {
            return (a.id == tokens[2]);
            })[0];
            
            // size scaling is 50 + (200-50) and also (value-min)/(max-min) of centrality measure
            // x y resize is half of that height and width value
            if(selcent=='Usage'){
                var min=0.0001478;
                var max=0.5137931;
                var diffmaxmin=max-min;
                var diffvarmin=varname.usage-min;
                var hw=50 + (200-50)*diffvarmin/diffmaxmin;
                var xy=-hw/2;
                thisnode.select('image')
                .transition()
                .attr("x", function(d) { return xy;})
                .attr("y", function(d) { return xy;})
                .attr("height", hw)
                .attr("width", hw)
                document.getElementById("maxcent").innerHTML = 'Max: ' + (descusage[0].usage*100).toFixed(2) + "% ("  + descusage[0].id + ")";
/*                document.getElementById("mincent").innerHTML = 'Min: ' + ascusage[0].usage;*/
                document.getElementById("top1").innerHTML = 'Rank 1: ' + descusage[0].id + " ("  + (descusage[0].usage*100).toFixed(2) + "%)";
                document.getElementById("top2").innerHTML = 'Rank 2: ' + descusage[1].id + " ("  + (descusage[1].usage*100).toFixed(2) + "%)";;
                document.getElementById("top3").innerHTML = 'Rank 3: ' + descusage[2].id + " ("  + (descusage[2].usage*100).toFixed(2) + "%)";;
                document.getElementById("top4").innerHTML = 'Rank 4: ' + descusage[3].id + " ("  + (descusage[3].usage*100).toFixed(2) + "%)";;
                document.getElementById("top5").innerHTML = 'Rank 5: ' + descusage[4].id + " ("  + (descusage[4].usage*100).toFixed(2) + "%)";;
                document.getElementById("top6").innerHTML = 'Rank 6: ' + descusage[5].id + " ("  + (descusage[6].usage*100).toFixed(2) + "%)";;
            }
            else if(selcent=='In Degree'){
                var min=0;
                var max=18;
                var diffmaxmin=max-min;
                var diffvarmin=varname.din-min;
                var hw=50 + (200-50)*diffvarmin/diffmaxmin;
                var xy=-hw/2;
                thisnode.select('image')
                .transition()
                .attr("x", function(d) { return xy;})
                .attr("y", function(d) { return xy;})
                .attr("height", hw)
                .attr("width", hw)
            }
            else if(selcent=='Between Centrality'){
                var min=0;
                var max=71;
                var diffmaxmin=max-min;
                var diffvarmin=varname.bt-min;
                var hw=50 + (200-50)*diffvarmin/diffmaxmin;
                var xy=-hw/2;
                thisnode.select('image')
                .transition()
                .attr("x", function(d) { return xy;})
                .attr("y", function(d) { return xy;})
                .attr("height", hw)
                .attr("width", hw)
            }
            else if(selcent=='Page Rank Prob.'){
                var min=0.00112;
                var max=0.2261;
                var diffmaxmin=max-min;
                var diffvarmin=varname.pgr-min;
                var hw=50 + (200-50)*diffvarmin/diffmaxmin;
                var xy=-hw/2;
                thisnode.select('image')
                .transition()
                .attr("x", function(d) { return xy;})
                .attr("y", function(d) { return xy;})
                .attr("height", hw)
                .attr("width", hw)
            }
            else if(selcent=='Viability'){
                var min=29;
                var max=75;
                var diffmaxmin=max-min;
                var diffvarmin=varname.gxe95-min;
                var hw=50 + (200-50)*diffvarmin/diffmaxmin;
                var xy=-hw/2;
                thisnode.select('image')
                .transition()
                .attr("x", function(d) { return xy;})
                .attr("y", function(d) { return xy;})
                .attr("height", hw)
                .attr("width", hw)
            }

        })
 });
    
 d3.select('#Reset').on('click', function(){
        //get type selected
        var selpoke = d3.select("#myDD").node().value
        document.getElementById("poketype1").innerHTML = 'Type 1: ';
        document.getElementById("poketype2").innerHTML = 'Type 2: ';
        document.getElementById("pokedgr").innerHTML = 'In Degree: ';
        document.getElementById("pokebt").innerHTML = 'Between Centrality: ';
        document.getElementById("pokepgr").innerHTML = 'Page Rank Prob.: ';
        document.getElementById("type").innerHTML = 'Type: ';
        document.getElementById("count").innerHTML = 'Count: ';
        document.getElementById("vblty").innerHTML = 'Viability: ';
        document.getElementById("usage").innerHTML = 'Usage: ';
        document.getElementById("maxcent").innerHTML = 'Max: ';
        document.getElementById("mincent").innerHTML = 'Min: ';
        document.getElementById("top1").innerHTML = 'Rank 1: ';
        document.getElementById("top2").innerHTML = 'Rank 2: ';
        document.getElementById("top3").innerHTML = 'Rank 3: ';
        document.getElementById("top4").innerHTML = 'Rank 4: ';
        document.getElementById("top5").innerHTML = 'Rank 5: ';
        document.getElementById("top6").innerHTML = 'Rank 6: ';
        
        //reset all circle colors to black and full opacity
        nodeEnter.each(function(d, i){
                var thisnode2=d3.select(this);
                thisnode2.attr("class","Black");
                thisnode2.transition().style("opacity", 1);
                thisnode2.select('image')
                .transition()
                .attr("x", function(d) { return -25;})
                .attr("y", function(d) { return -25;})
                .attr("height", 50)
                .attr("width", 50)
        })

 });
    

  force.on("tick", function() {
    node.attr("cx", function(d) { return d.x = Math.max(radius, Math.min(width - radius, d.x)); })
        .attr("cy", function(d) { return d.y = Math.max(radius, Math.min(height - radius, d.y)); });    
      
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
  });
});

</script>